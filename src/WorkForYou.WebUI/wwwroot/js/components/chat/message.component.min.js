import{sendChatMessage}from"../../services/send-message.service.js";const connection=(new signalR.HubConnectionBuilder).withUrl("/hubs/chatHub").build(),sendMessageForm=document.getElementById("send-message-form"),messageInput=document.getElementById("message-input"),messageIdInput=document.getElementById("message-id-input"),currentUsername=document.getElementById("current-username"),ownClassName="chat-details-wrapper__body-message message-own",notOwnClassName="chat-details-wrapper__body-message message-not-my";function sendMessage(e){e.preventDefault();e={message:messageInput.value,roomId:+messageIdInput.value};messageInput.value="",sendChatMessage("/sendMessage",e).catch(e=>{console.error("An error occurred while trying to send the message: "+e)})}connection.on("ReceiveMessage",e=>{var n=document.getElementById("message-list"),t=document.createElement("div"),s=(currentUsername.value===e.name?t.setAttribute("class",ownClassName):t.setAttribute("class",notOwnClassName),document.createElement("p")),a=(s.appendChild(document.createTextNode(e.content)),document.createElement("span")),a=(a.appendChild(document.createTextNode(e.name)),s.appendChild(a),document.createElement("span"));a.appendChild(document.createTextNode(e.timestamp)),t.appendChild(s),t.appendChild(a),n.appendChild(t)}),connection.start().then(()=>{connection.invoke("joinToRoom",messageIdInput.value).then()}).catch(e=>{console.error(e)}),window.addEventListener("onunload",()=>{connection.invoke("leaveRoom",messageIdInput.value).then()}),window.addEventListener("load",()=>{window.scrollTo(0,document.body.scrollHeight)}),sendMessageForm.addEventListener("submit",e=>{e.preventDefault(),sendMessage(e)});